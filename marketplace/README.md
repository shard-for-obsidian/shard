# Shard Plugin Marketplace

This directory contains the Shard marketplace website and plugin metadata.

## Website

The marketplace website is built with [Hugo](https://gohugo.io/) and deployed to GitHub Pages.

**Live site:** https://gillisandrew.github.io/shard/

### Local Development

```bash
# Install Hugo (macOS)
brew install hugo

# Or download from https://gohugo.io/installation/

# Generate plugins.json from markdown files
pnpm marketplace:generate

# Start development server
cd marketplace
hugo server -D

# Open http://localhost:1313/shard/
```

### Site Structure

- `hugo.toml` - Hugo configuration
- `content/` - Markdown content pages
- `layouts/` - HTML templates
- `static/` - Static assets (CSS, images)
- `plugins/` - Plugin markdown source files
- `data/plugins.json` - Generated plugin index (auto-generated by GitHub Actions)
- `scripts/` - Build and generation scripts

## Submitting Your Plugin

To submit your plugin to the Shard marketplace:

### Via CLI (Recommended)

```bash
# 1. Push your plugin to GHCR
shard push ./dist ghcr.io/username/your-plugin

# 2. Register to marketplace
shard marketplace register ghcr.io/username/your-plugin \
  --token YOUR_GITHUB_TOKEN \
  --introduction "$(cat INTRODUCTION.md)"

# 3. Submit pull request with generated markdown file
```

The CLI will:

- Pull the latest version from GHCR to get plugin metadata
- Create a markdown file with YAML frontmatter
- **Automatically query all available versions from the OCI registry** (no manual version tracking needed!)
- Include your plugin introduction as markdown content

### Manually

1. Fork this repository
2. Create a new markdown file in `marketplace/plugins/` directory named `<plugin-id>.md`
3. Add YAML frontmatter with metadata (see template below)
4. Write a 1-2 paragraph introduction about your plugin
5. Submit a pull request

### Plugin Markdown Template

```markdown
---
id: your-plugin-id
registryUrl: ghcr.io/username/repository
name: Your Plugin Name
author: Your Name
description: A brief description of your plugin
repository: https://github.com/username/repository
minObsidianVersion: 0.15.0
authorUrl: https://yourwebsite.com
license: MIT
---

# Your Plugin Name

Write a compelling 1-2 paragraph introduction about your plugin here. This will appear on your plugin's marketplace page.

## Features

- Key feature 1
- Key feature 2
- Key feature 3
```

**Required frontmatter fields:**

- `id` - Plugin ID from manifest.json
- `registryUrl` - GHCR registry URL (e.g., ghcr.io/owner/repo)
- `name` - Plugin display name
- `author` - Plugin author
- `description` - Brief description

**Optional frontmatter fields:**

- `repository` - GitHub repository URL (auto-derived from OCI annotations if not provided)
- `minObsidianVersion` - Minimum Obsidian version required
- `authorUrl` - Author website or profile URL
- `license` - Plugin license (e.g., MIT, GPL-3.0)

**Note:** Version fields are **no longer needed**! The build system automatically queries all available versions from the OCI registry using the OCI Distribution API.

### Requirements

- Plugin must be published to GHCR (GitHub Container Registry)
- Plugin must follow OCI format specification
- Plugin must include proper OCI annotations (automatically added by `shard push` and `shard convert`)
- Repository must be publicly accessible or provide auth documentation

## Automated Build

The `data/plugins.json` file and website are automatically generated and deployed via GitHub Actions:

1. When markdown files in `marketplace/plugins/` change
2. GitHub Action runs `pnpm marketplace:generate` to:
   - Parse markdown files with YAML frontmatter
   - **Query all available versions from each plugin's OCI registry**
   - Fetch metadata for each version (published date, size, commit SHA)
   - Generate enriched `data/plugins.json` with full version history
3. Plugin markdown files are copied to Hugo content directory
4. Hugo builds the static site with individual plugin pages
5. Site is deployed to GitHub Pages

Do not edit `data/plugins.json` manually - it will be overwritten by the GitHub Action.

### Version Querying

The build system automatically queries the OCI registry for each plugin to discover all available versions. This means:

- No manual version tracking required
- Always shows up-to-date version list
- Includes metadata: published date, package size, commit SHA
- Uses OCI Distribution API tags and manifest endpoints

You can test version querying locally:

```bash
# Query all versions for a plugin
shard marketplace versions ghcr.io/username/repository

# Example output:
# Found 3 version(s):
# - 1.0.0 (published 2026-02-06, 245 KB)
#   Commit: abc1234
# - 0.9.0 (published 2026-01-15, 230 KB)
#   Commit: def5678
```
